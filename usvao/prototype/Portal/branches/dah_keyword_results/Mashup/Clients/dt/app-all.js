/*
Copyright(c) 2012 Company Name
*/
Ext.define("Mvp.util.ExtBugWorkarounds",{requires:["Ext.data.Store","Ext.grid.PagingScroller","Ext.view.AbstractView","Ext.layout.ContextItem"],statics:{closeTabBug:function(){Ext.override(Ext.view.AbstractView,{bindStore:function(a,b){if(!b&&this.store){if(a!==this.store&&this.store.autoDestroy){this.store.destroy()}else{this.mun(this.store,{scope:this,datachanged:this.onDataChanged,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.refresh})}if(!a){if(this.loadMask&&typeof this.loadMask.bindStore=="function"){this.loadMask.bindStore(null)}this.store=null}}if(a){a=Ext.data.StoreManager.lookup(a);this.mon(a,{scope:this,datachanged:this.onDataChanged,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,clear:this.refresh});if(this.loadMask&&typeof this.loadMask.bindStore=="function"){this.loadMask.bindStore(a)}}this.store=a;this.getSelectionModel().bind(a);if(a&&(!b||a.getCount())){this.refresh(true)}}})},scrollBarSizeBug:function(){Ext.override(Ext.grid.PagingScroller,{onViewRefresh:function(){var c=this,e=c.store,b,d=c.view,h=d.el.dom,j,g,a,i,f;if(!e.getCount()){return}if(e.getCount()===e.getTotalCount()){}else{c.disabled=false}c.stretcher.setHeight(b=c.getScrollHeight());if(c.scrollProportion!==undefined){i=c.view.el.child("table",true);c.scrollProportion=d.el.dom.scrollTop/(b-i.offsetHeight);i=c.view.el.child("table",true);i.style.position="absolute";i.style.top=(c.scrollProportion?(b*c.scrollProportion)-(i.offsetHeight*c.scrollProportion):0)+"px"}else{i=c.view.el.child("table",true);i.style.position="absolute";i.style.top=(f=(c.tableStart||0)*c.rowHeight)+"px";if(c.scrollOffset){j=d.getNodes();g=-d.el.getOffsetsTo(j[c.commonRecordIndex])[1];a=g-c.scrollOffset;c.position=(d.el.dom.scrollTop+=a)}else{if((f>h.scrollTop)||((f+i.offsetHeight)<h.scrollTop+h.clientHeight)){c.position=h.scrollTop=f}}}}})},sortSmallDataSetBug:function(){Ext.override(Ext.data.Store,{prefetchPage:function(f,c){var e=this,b=e.pageSize||e.defaultPageSize,g=(f-1)*e.pageSize,a=g+b,d=e.getTotalCount();if(d){a=Math.min(a,d)}e.prefetch(Ext.apply({page:f,start:g,limit:b},c))}})},filterBug_4_1_0:function(){Ext.override(Ext.data.Store,{cancelAllPrefetches:function(){var c=this,a=c.pageRequests,b,d;if(c.pageMap.events.pageadded){c.pageMap.events.pageadded.clearListeners()}for(d in a){if(a.hasOwnProperty(d)){b=a[d];delete a[d];if(b&&b.callback){delete b.callback}}}}})},googleChrome18Bug:function(){Ext.override(Ext.layout.ContextItem,{setHeight:function(a,c){var e=this,b=e.target,g,d,f;if(isNaN(a)){return}if(a<0){a=0}if(!e.wrapsComponent){if(!e.setProp("height",a,c)){return NaN}}else{a=Ext.Number.constrain(a,b.minHeight||0,b.maxHeight);if(!e.setProp("height",a,c)){return NaN}g=e.frameBodyContext;if(g){d=e.getFrameInfo();g.setHeight(a-d.height,c)}}return a},setWidth:function(c,b){var e=this,a=e.target,g,d,f;if(isNaN(c)){return}if(c<0){c=0}if(!e.wrapsComponent){if(!e.setProp("width",c,b)){return NaN}}else{c=Ext.Number.constrain(c,a.minWidth||0,a.maxWidth);if(!e.setProp("width",c,b)){return NaN}g=e.frameBodyContext;if(g){d=e.getFrameInfo();g.setWidth(c-d.width,b)}}return c}})},noGridScroller:function(){Ext.override(Ext.grid.PagingScroller,{handleViewScroll:function(g){var d=this,i=d.store,f=d.view,e=d.viewSize,j=i.getTotalCount(),c=j-e,b=d.getFirstVisibleRowIndex(),h=d.getLastVisibleRowIndex(),a,k;d.scrollProportion=undefined;if(g==-1){if(b!==undefined){if(b<(d.tableStart+d.numFromEdge)){a=Math.max(0,h+d.trailingBufferZone-e)}}else{d.scrollProportion=f.el.dom.scrollTop/(f.el.dom.scrollHeight-f.el.dom.clientHeight);a=Math.max(0,j*d.scrollProportion-(e/2)-d.numFromEdge-((d.leadingBufferZone+d.trailingBufferZone)/2))}}else{if(b!==undefined){if(h>(d.tableEnd-d.numFromEdge)){a=Math.max(0,b-d.trailingBufferZone)}}else{d.scrollProportion=f.el.dom.scrollTop/(f.el.dom.scrollHeight-f.el.dom.clientHeight);a=j*d.scrollProportion-(e/2)-d.numFromEdge-((d.leadingBufferZone+d.trailingBufferZone)/2)}}if(a!==undefined){if(a>c){a=c&~1;k=j-1}else{a=a&~1;k=a+e-1}if(a<0){a=0}if(i.rangeCached(a,k)){d.cancelLoad();i.guaranteeRange(a,k);if(Ext.tomCount===undefined){Ext.tomCount=0}Ext.tomCount++}else{d.attemptLoad(a,k)}}}})}}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Mast.App",{extend:"Ext.ux.desktop.App",requires:["Ext.window.MessageBox","Ext.ux.desktop.ShortcutModel","MyDesktop.SystemStatus","MyDesktop.VideoWindow","MyDesktop.GridWindow","MyDesktop.SearchWindow","MyDesktop.AstroViewWindow","MyDesktop.DnDWindow","MyDesktop.TabWindow","MyDesktop.AccordionWindow","MyDesktop.Notepad","MyDesktop.BogusMenuModule","MyDesktop.BogusModule","Mast.Portal","Ext.data.Store","Ext.data.JsonReader","MyDesktop.Settings"],init:function(){AppConfig.useAV=false;this.createAndRunPortal({});AppConfig.useAV=true;this.callParent()},createAndRunPortal:function(a){var b=Mvp.util.ExtBugWorkarounds;b.scrollBarSizeBug();b.sortSmallDataSetBug();this.portal=Ext.create("Mast.Portal",a);this.portal.desktopApp=this;this.portal.run()},getModules:function(){return[new MyDesktop.VideoWindow(),new MyDesktop.SystemStatus(),new MyDesktop.GridWindow(),new MyDesktop.SearchWindow({portal:this.portal}),new MyDesktop.AstroViewWindow({portal:this.portal}),new MyDesktop.DnDWindow({portal:this.portal}),new MyDesktop.TabWindow(),new MyDesktop.AccordionWindow(),new MyDesktop.Notepad(),new MyDesktop.BogusMenuModule(),new MyDesktop.BogusModule()]},getDesktopConfig:function(){var b=this,a=b.callParent();return Ext.apply(a,{contextMenuItems:[{text:"Change Settings",handler:b.onSettings,scope:b}],shortcuts:Ext.create("Ext.data.Store",{model:"Ext.ux.desktop.ShortcutModel",data:[{name:"Search",iconCls:"search-shortcut",module:"search-win"},{name:"AstroView",iconCls:"astroview-shortcut",module:"astroview-win"},{name:"VO Space",iconCls:"folder-shortcut",module:"dnd-win"},{name:"Notepad",iconCls:"notepad-shortcut",module:"notepad"},{name:"System Status",iconCls:"cpu-shortcut",module:"systemstatus"}]}),wallpaper:"wallpapers/Blue-Sencha.jpg",wallpaperStretch:false})},getStartConfig:function(){var b=this,a=b.callParent();return Ext.apply(a,{title:"Tom Donaldson",iconCls:"user",height:300,toolConfig:{width:100,items:[{text:"Settings",iconCls:"settings",handler:b.onSettings,scope:b},"-",{text:"Logout",iconCls:"logout",handler:b.onLogout,scope:b}]}})},getTaskbarConfig:function(){var a=this.callParent();return Ext.apply(a,{quickStart:[],trayItems:[{xtype:"trayclock",flex:1}]})},onLogout:function(){Ext.Msg.confirm("Logout","Are you sure you want to logout?")},onSettings:function(){var a=new MyDesktop.Settings({desktop:this.desktop});a.show()}});
/*
 * Ext JS Library 4.0
 * Copyright(c) 2006-2011 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.define("Mast.App",{extend:"Ext.ux.desktop.App",requires:["Ext.window.MessageBox","Ext.ux.desktop.ShortcutModel","MyDesktop.SystemStatus","MyDesktop.VideoWindow","MyDesktop.GridWindow","MyDesktop.SearchWindow","MyDesktop.AstroViewWindow","MyDesktop.DnDWindow","MyDesktop.TabWindow","MyDesktop.AccordionWindow","MyDesktop.Notepad","MyDesktop.BogusMenuModule","MyDesktop.BogusModule","Mast.Portal","Ext.data.Store","Ext.data.JsonReader","MyDesktop.Settings"],init:function(){AppConfig.useAV=false;this.createAndRunPortal({});AppConfig.useAV=true;this.callParent()},createAndRunPortal:function(a){var b=Mvp.util.ExtBugWorkarounds;b.scrollBarSizeBug();b.sortSmallDataSetBug();this.portal=Ext.create("Mast.Portal",a);this.portal.desktopApp=this;this.portal.run()},getModules:function(){return[new MyDesktop.VideoWindow(),new MyDesktop.SystemStatus(),new MyDesktop.GridWindow(),new MyDesktop.SearchWindow({portal:this.portal}),new MyDesktop.AstroViewWindow({portal:this.portal}),new MyDesktop.DnDWindow({portal:this.portal}),new MyDesktop.TabWindow(),new MyDesktop.AccordionWindow(),new MyDesktop.Notepad(),new MyDesktop.BogusMenuModule(),new MyDesktop.BogusModule()]},getDesktopConfig:function(){var b=this,a=b.callParent();return Ext.apply(a,{contextMenuItems:[{text:"Change Settings",handler:b.onSettings,scope:b}],shortcuts:Ext.create("Ext.data.Store",{model:"Ext.ux.desktop.ShortcutModel",data:[{name:"Search",iconCls:"search-shortcut",module:"search-win"},{name:"AstroView",iconCls:"astroview-shortcut",module:"astroview-win"},{name:"VO Space",iconCls:"folder-shortcut",module:"dnd-win"},{name:"Notepad",iconCls:"notepad-shortcut",module:"notepad"},{name:"System Status",iconCls:"cpu-shortcut",module:"systemstatus"}]}),wallpaper:"wallpapers/Blue-Sencha.jpg",wallpaperStretch:false})},getStartConfig:function(){var b=this,a=b.callParent();return Ext.apply(a,{title:"Tom Donaldson",iconCls:"user",height:300,toolConfig:{width:100,items:[{text:"Settings",iconCls:"settings",handler:b.onSettings,scope:b},"-",{text:"Logout",iconCls:"logout",handler:b.onLogout,scope:b}]}})},getTaskbarConfig:function(){var a=this.callParent();return Ext.apply(a,{quickStart:[],trayItems:[{xtype:"trayclock",flex:1}]})},onLogout:function(){Ext.Msg.confirm("Logout","Are you sure you want to logout?")},onSettings:function(){var a=new MyDesktop.Settings({desktop:this.desktop});a.show()}});
