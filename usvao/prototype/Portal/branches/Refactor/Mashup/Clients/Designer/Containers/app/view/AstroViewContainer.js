/*
 * File: app/view/AstroViewContainer.js
 * Date: Tue Dec 13 2011 15:29:39 GMT-0500 (Eastern Standard Time)
 *
 * This file was generated by Ext Designer version 1.2.2.
 * http://www.sencha.com/products/designer/
 *
 * This file will be generated the first time you export.
 *
 * You should implement event handling and custom methods in this
 * class.
 */

Ext.define('Mvpc.view.AstroViewContainer', {
    extend: 'Mvpc.view.ui.AstroViewContainer',
    
    constructor: function () {
        this.callParent(arguments);
        
        // Store rendertype type if passed in as argument
        this.rendertype = "webgl";
        if (arguments && arguments.length > 0 && arguments[0].rendertype)
        {
            this.rendertype = arguments[0].rendertype;
        }
        
        // Validate rendertype argument
        if (this.rendertype !== "flash" &&
            this.rendertype !== "webgl" &&
            this.rendertype !== "canvas" &&
            this.rendertype !== "svg")
        {
            alert ("Unknown rendertype option passed to AstroViewContainer: " + this.rendertype);
        }
        
        // Create underlying AstroView flash rendertype now if specified
        // Create Astroview webgl/canvas rendertype after onLayout() is invoked
        if (this.rendertype === "flash")
        {
            this.createAstroViewFlash();
        }
    },

    initComponent: function () {
        var me = this;
        me.callParent(arguments);
        this.on('afterLayout', this.onAfterLayout, this);
    },
    
    onAfterLayout: function(arg)
    {
        if (this.rendertype !== "flash")
        {
            this.createAstroViewThreeJs();
        }
    },
    
    createAstroViewThreeJs: function()
    {
        var element = document.getElementById(this.id);
        this.astroview = new ASTROVIEW.AstroBasicView(element, this.rendertype);
        
        // We set the global variable AstroView so that the Portal Application can find it.
        AstroView = this.astroview;
    },
    
    createAstroViewFlash: function()
    {
        this.astroview = Ext.create('Ext.flash.Component', {
            id: 'AstroView',
            url: '../AstroView/AstroView.swf'
        });

        this.add(this.astroview);
        this.astroview.on('success', this.onFlashSuccess, this);
    },

    onFlashSuccess: function () {
        this.swfId = this.astroview.swfId;
    }
});