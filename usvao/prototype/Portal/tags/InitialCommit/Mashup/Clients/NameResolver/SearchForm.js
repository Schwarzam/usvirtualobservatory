/*
 * File: SearchForm.js
 * Date: Thu Feb 24 2011 15:49:39 GMT-0500 (EST)
 * 
 * This file was generated by Ext Designer version xds-1.0.3.2.
 * http://www.extjs.com/products/designer/
 *
 * This file will be generated the first time you export.
 *
 * You should implement event handling and custom methods in this
 * class.
 */

SearchForm = Ext.extend(SearchFormUi, {
  
    initComponent: function()
    {
        SearchForm.superclass.initComponent.call(this);        
        this.btnSearch.on('click', this.onBtnSearchClick, this);       
    },
    
    onBtnSearchClick : function()
    {
        //alert("Sending request..." + this.txtSearchBox.getValue());
            
        Ext.lib.Ajax.useDefaultXhrHeader=false
        
        Ext.Ajax.request({ 
            method: 'GET',
            params :{query: this.txtSearchBox.getValue() },
            url: 'http://galex.stsci.edu/gxws/NameResolver/NameResolver.asmx/resolve',
            success: function ( result, request ) {
                var dq = Ext.DomQuery;
                var xml = result.responseXML;
                
                var ra = dq.selectValue('ra', xml);
                var dec = dq.selectValue('dec', xml);
                var sr = dq.selectValue('searchRadius', xml);
        
                var lblResolved = Ext.ComponentMgr.get('lblResolved');
                
                var sResolved = "Resolved:" +
                " ra:" + ra +
                " dec:" + dec +
                (sr > 0 ? " radius: " + sr : "");
                   
                lblResolved.setText(sResolved);
            },
            failure: function(result, request) {
                console.log("failure: " + result);
                var lblResolved = Ext.ComponentMgr.get('lblResolved');
                var txtSearchBox = Ext.ComponentMgr.get('txtSearchBox');
                lblResolved.setText("Unable to resolve: " + txtSearchBox.getValue());
            }
        });
    }
});
Ext.ComponentManager.register('widget.searchform', SearchForm);

